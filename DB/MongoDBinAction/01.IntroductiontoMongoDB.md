# Chapter 01 "최신 우베을 위한 도큐먼트 데이터베이스"

## 1. MongoDB의 설계 목표

* MongoDB: 웹 애플리케이션과 인터넷 기반을 위해 설계된 DB 관리 시스템
* 직관적인 데이터 모델
* 데이터를 행(row) 대신에 도큐먼트(document)에 저장한다.
    * 데이터의 변경이 발생했을 때 테이블을 추가하거나 스키마를 맞춰야 하는 걱정 없이 구조화된 도큐먼트를 DB에 저장할 수 있다.
    * 복잡한 정규화의 과정없이 하나의 Document 에 모든 데이터를 관리한다.
    * JSON에 기반한다 - key/value로 이루어져 있고, 중첩에 제한이 없다.
    * 계층적인 구조의 데이터를 표현할 수 있다.
* 프로그래밍 언어에서 정의한 객체가 그대로 저장되므로 객체 mapper의 복잡성이 사라진다.<br>
즉, 애플리케이션상에서 빠르게 개발할 수 있는 도구이다.

## 2. MongoDB의 핵심 기능

### 2.1. 도큐먼트 데이터 모델

* 하나의 도큐먼트로 다양한 구조의 데이터를 표현할 수 있다.
* 데이터를 컬렉션(collection)에 도큐먼트로 저장한다.
* vs. RDB
    * 한 객체(object)의 데이터를 여러 개의 테이블로 나누어 표현하는 정규화를 통해, 하나의 단위 데이터를 오직 하나의 테이블로만 표현할 수 있고 JOIN 연산이 필요하다.
    * 모델에 대한 설계 과정이 필요하며, 설계가 변경 되었을 경우 관계를 고려하여 각 테이블 스키마를 수정해야 한다.
* 스키마가 없는 도큐먼트의 장점
    * DB가 아닌 애플리케이션이 데이터 구조를 정한다.
    * 가변적인 속성을 갖는 데이터를 표현할 수 있다. 새로운 속성을 동적으로 생성하는 것이 용이해진다.<br>
    즉, 추후에 필요할 데이터 필드가 무엇인지에 대해서 걱정할 필요가 없다.
    * 조인이 필요 없다.
* 내부적으로 MongoDB 는 Binary JSON (BSON) 형태로 Document를 저장한다.<br>
BJON 은 JSON 형태의 전문을 Binary 코드로 인코딩한 문자열이다.

### 2.2. 애드훅 쿼리

* 애드훅 쿼리(ad hoc query): 미리 정해지지 않은 질의 사항을 실행 단계에서 지정해 질의 할 수 있는 쿼리 방식

```sql
SELECT ITEM_ID, ITEM_NM
  FROM ITEM
 WHERE ITEM_ID = 1000000000123
   AND SELL_CNT > 10
;
```

```javascript
db.test.find({itemId:1000000000123, sellCnt:{'$gt':10}});
```

### 2.3. 인덱스(INDEX)

* 효과적으로 데이터를 검색할 수 있는 방법
* B-tree로 구현되어 있다.
* 여러 개의 Secondary Index를 허용함으로써, 넓은 범위의 쿼리를 최적화하도록 허용한다. (64개까지 가능)

### 2.4. 복제 (Replica)

* 복제 세트(replica set) 구성 - 서버와 네트워크 장애가 발생할 경우를 대비해 중복성과 장애 조치 자동화를 위해 데이터를 여러 대의 서버에 분산한다.
* 각각의 mongoDB 서버는 분리된 물리 장비에 별도로 존재하며, 이를 노드(node)라고 부른다.
* 자동 장애조치를 지원한다.

### 2.5. 속도와 내구성

* 쓰기 속도와 내구성 사이의 역관계
    * 쓰기 속도(write speed): DB가 얼마나 많은 수의 삽입, 수정, 삭제 명령을 처리할 수 있는가
    * 내구성(durability): 쓰기 연산이 디스크에 제대로 이루어졌는가
* 쓰기 시맨틱스(write semantics)와 저널링(journaling, 로그 기록)을 통해 속도와 내구성 사이에서 타협을 이룰 수 있다.

### 2.6. 확장

* 확장의 종류
    * 수직적/상향식 확장: 하드웨어를 업그레이드하거나 추가
    * 수평적/외적 확장: DB를 여러 대의 서버에 분산시키는 것
        * 한 대의 서버가 전체 시스템에서 차지하는 비중이 훨씬 더 작으므로 장애로 인한 피해가 훨씬 작다.
* MongoDB는 수평적 확장이 용이하도록 설계되어 있다.
* Sharding: 범위 기반(ranged-base) 파티션 메커니즘. 데이터를 여러 노드에 분산하는 것을 자동을 관리해준다.

## 3. MongoDB 코어 서버와 툴

### 3.1. 코어 서버

* 코어 데이터베이스 서버는 mongodb(윈도우에서는 mongodb.exe) 라는 실행 프로그램을 통해 구동된다.

### 3.2. 자바스크립트 셸

* 명령어를 SQL 대신 자바스크립트로 표현한다.

### 3.3. 데이터베이스 드라이버

* 애플리케이션상에서 MongoDB 서버와 통신하기 위해 사용된다.

## 4. MongoDB를 사용하는 이유

* key/value 저장 시스템의 장점 - 시스템의 단순성으로 인해 속도가 매우 빠르고 확장이 용이하다.
* 다양한 구조의 데이터를 저장할 수 있다.
* 스키마가 존재하지 안흔 데이터를 저장하기가 용이하므로 미리 구조가 알려지지 않은 데이터를 저장하는데 유용하다.
* 웹 애플리케이션에서 일차 데이터 저장 시스템으로 적합하다.

